---
title: "AstToAst"
author: "Konrad Kr√§mer"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Internals

The user passes R code which defines the body of the function to be translated. Furthermore, the information of the types for the arguments passed to the function have to be defined.

* Get Abstract Syntax Tree (AST) from R Code
* Deduce Types of all code lines with an assignment
* Translate AST to C++ Code

In C++ an expression template library is used which has scalars, vectors and matrices which behave as much as possible as the corresponding R objects. 

<!---
\newpage

![What happens in R](./Rstuff.jpg)

\newpage

![What happens in C++](./cppstuff.jpg)
-->

```{r}
library(AstToAst)
input_variables <- list(y = "num_vec", x = "num", z = "num_mat") # y = vec_num und x = scalar num
code <- "y <- y + x + 1
         z <- y + 1
         h <- z*2
         print(y)
         if(z > 1) {
         print('test') }
         for(i in 1:10) {print(i)}"

test <- sep_expressions(code)
# Seperated expressions
test
test <- extractast(test)
# ast of second expression
test[[2]]
get_assignments(test)
vars <- storage_variables(test)
vars
temp <- unlist(test[[2]][3])
find_var_at_rhs(as.character(temp))
vars_rhs <- variables_at_rhs(test)
vars_rhs
vars_list <- translate(test, input_variables)
vars_list
new_code <- type_of_lhs(test, input_variables)
one <- new_code[[1]]
out <- get_calls(one)

# simple language object transformation
types <- types_of_each_line(new_code, input_variables)
code <- adding_type(new_code, types)
get_calls(code[[1]])
get_calls(code[[2]])
get_calls(code[[3]])
get_calls(code[[4]])
get_calls(code[[5]])
get_calls(code[[6]])

allvar <- all_vars(new_code, input_variables)
allvar
```

